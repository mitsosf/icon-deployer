import React, {useState} from 'react';
import { Form, Input, Button } from 'antd';
import { IconService } from 'icon-sdk-js';

const IRC3Form = ({address, networkId}) => {
    const [transaction_result, setTransactionResult] = useState('');


    const eventHandler = event => {
        const { type, payload } = event.detail;
        if (type === 'RESPONSE_JSON-RPC') {
            console.log(payload)
            setTransactionResult(payload);
        }

        else if (type === 'CANCEL_JSON-RPC') {
            console.error('User canceled deployment request')
        }
    }
    window.addEventListener('ICONEX_RELAY_RESPONSE', eventHandler);

    const onFinish = (values) => {
        const iconService = IconService;
        const IconBuilder = iconService.IconBuilder;
        const deployTransactionBuilder = new IconBuilder.DeployTransactionBuilder();
        const deployTransaction = deployTransactionBuilder
            .from(address)
            .to('cx0000000000000000000000000000000000000000')
            .nid(iconService.IconConverter.toBigNumber(networkId))
            .value(iconService.IconConverter.toBigNumber(0))
            .timestamp((new Date()).getTime() * 1000)
            .stepLimit(iconService.IconConverter.toBigNumber(1120000000))
            .version(iconService.IconConverter.toBigNumber(3))
            .contentType('application/java')
            .nonce(iconService.IconConverter.toBigNumber(1))
            .content('0x504b03041400080808000000210000000000000000000000000014000d004d4554412d494e462f4d414e49464553542e4d46555405000100000000feca0000f34dcccb4c4b2d2ed10d4b2d2acecccfb35230d433e0e5f24dccccd375ce492c2eb65270e5e5e2e50200504b0708eb643fc02a00000028000000504b0304140008080800000021000000000000000000000000000d0009004d4554412d494e462f41504953555405000100000000b593c16a83401086d795dcfb263e80a5901c0a42c0437a5fd6b85a5bdd957593d6b788ad780f4dd49040a1859e7d903e4c574d2ead8224f436ecfef3cdf0cfcc37b8cac086e280a86095c08fe9035e62cdc7d4d566827bd4d5339047716031bf5fb0b3b07c9813d3519524cd117ba284bf4fa339e3441bdb362751a48faa44591b19289adf565a22c11e0935ecaf161b6071af4d3cd7a082b884eb4a958c7e7332b07789188721674b629f4f29708b80f0257d9384bffd0e00af32500a8e69e4107e29e87002dd721640f535dd2247461db84baaec0513d89f2dc2d08feb89363339348993d8a036796e67e8d5e1da90de293db80c7c3669a663d6133d654b177a3760181796774727c03fb900cb767fb05f57e86f77878e4b629f6b777eed514fdc00e9ca16d567d67140b04a0bd4de58e7afc46c028f0a3868d76bb5b5e074a0fa07504b0708caf61b074301000001040000504b03041400080808000000210000000000000000000000000007000900452e636c6173735554050001000000007591cb4ec2501086ff0368b1d42b82f70b782b1765e1c205c6441a4d4c3424625cb02b702cd5d2c6d3a2be961b202e7c001fca3847118dc42ece64e67cf39ff9a76fef2faf000eb0cbc04e14300a86823043fcecd2d82f99be5dbff2eeb8bb776b3e980ca387b66b07470c3bfab9ac141cd3b50a9540d8ae551cae64ae358c425111419421d2b2dd8061a1dfda328366a1645b676ec02d2e086618f7eb9ee005c3a3da53a0406318b37860988ec305c3b49e39ff228e1b0dc17dbfa86102932ac631c51025b2fce872a161e6ab181f28f679050932c1efdba6e333247e9b28d76e793d2866aa1ae630af2289050645106b0b4ec3eb55e96609cb527885f66431e8fa9f71fe73a6610deb720d2952aab5854bd29e1cb57cf3b3cba1b621af9bd85211c236bdded4a0232625332469780d9a51ad786d51e7a7b6c391222e02f985c1e44fa03347599cf23045259bcb7731f6fc89502b627d2045d7218a891ea67b98ed60b187d52c25b92ed2dff8c6004f132cf592d95c073b17c4e5fb2dc467bff93c9d218c7c00504b07087beed8bf870100006f020000504b03041400080808000000210000000000000000000000000007000900412e636c6173735554050001000000003bf56fd73e06060673067646064647760646460681acc4b244fd9cc4bc747dffa4acd4e41276066646064ecf2067633d9014230357707e695172aa5b664e2a1b230313030b03043032b0014926065600504b070825417ef55000000056000000504b03041400080808000000210000000000000000000000000007000900422e636c61737355540500010000000075926f4fd35014c69fbb3f74ed2a42d9646c2a82886ba74c4505ede4c548962c5962e212082fcbd6d492b9255dd12fe50b49600b92185ffba18ce7b47711dc6cd2f6f69cdf79ee7dcee9afdfdf7f00d8c19e80a82b10020b27ce67a7da73fa5ef5fdf189db09152405b2cd7ed876c32d4e124ab7d1fa0bb6c3c0ef7b36258e0592ad06ad4aad462d263e39e1c76addf748c1f5dcc0dea3ec5ccdeffb216d9a2f4fcb98072452360f7464714b430af33ae6a0a8486081b66828300472b3b415e4043667485e8becf79ce1d08ed5ef6858c2b28e0c54565f219f5f023f7463e302c5726bd81904aeecc421e702bb558f8e684ca714dc134847123a56a167711f0f04b4c075ba13cd959b9a1f28459a2689fe231967146c4881d80a392f9bd306756ce271168f50665fba466eaca88b4deedd13f6f994f76e9ab387c293685ed78dcf60736f9e71f573ea7c273afdcc7a6ec88d59ca7aeef3365eb1c26b52e8ead88dbfde08a86ddfeb3be169e00aa4f6075d7a69edc169d0711b7ecfc51a7948d1cf9980c1e3a795c18382801d45358a09364bcf1a453690a62850b0c6b86d552eb0685d61e9a862e4c7285ca07806be54947057562c13cf1559ab728ec54bac253081d6f1504245246905cc5f2171645dc21418a3f22de204f75672397a3397b1ce511c61ebab2432a84aa220b7d399288df0e227f2139d6dbc94545e522a53951176ce24b2fb5fe4ed0479173526fd07504b07086ebdec4910020000d6030000504b03041400080808000000210000000000000000000000000007000900432e636c6173735554050001000000009556897f13d711fed692916caf8dd900896d2022a4b6244b76cb991a95e00bead647821cb78636ed5a5acb82f5aeb35a1b9bdea4254d7a5f69a147d2b40d3d680b24d82690945ed0a6f77df72fa1c7ccdb27599665427e3ef6bdd939bef966e6bd7df9bf2fbc04600ffead40e90e4051507f549fd1db4dddcab40f8d1d35526e003e7ad91940a582babe43dd3bbaf45c36d5c66a244f2958db9f4bd98ed1de994e3b462eb797a46905b5523aa23b3d5d24db5abc4ff42f4549ba4ed6caecddc77606fd8d5318a9db934db9c2f89e65824449c0fe2ecf3aa3c0d7df43ab687f8f8c30a9bb13ed5dd94c9fe51a19c3d95b6229cc2614ec2af17fbbb66b12592bebee53d0125e99d14a496484108623232a36e2ae6af8d1a0c06fe99346104dcb98f7f403d84c3c7a51bb6d42314bc5b85b41d0328e0b1a156cbf75dc6e5327a49165a550b115f75423846d2aaa5153850abc8632c9cd4d8ed966102d2a6a3d69444160c236d386930ba29588ea0a20aea08aa27b3c29d8f16ac2cb6aaa68c76b39feeb54d4612d47da41ce7b02d84530ece39688b747c1fa725508e0f5054e642502a04aecb91d242ba18952bca11abbb14fc53a688c663fe5a84f4d39f68c6e12922e15eb3d983d0a6a8a980ce000953363b804351ce92f9d1b4af48de8abc141bc89d472acb621bc528b21f46380f5064b1dc93c08cf984e82943144c3a1854b1a31d2a722882a469824068d47a609f72ac10eab780823d548e02d0aee1d62b243bae72794d22dcb76436346e884e1d8797110a3d4070e79cd3a349e1bc387cbf5b58a23781b17f5ed0ad4e27207f00e05cde5a094274cafc13b3146fda08b51a1d4d230aad106ca3c209a8339c88f5be98846561c45daa06dc58dd96cce352c37e4dac70c2b88a3e4df56705f195865922b07d4c424378d451d410dd029bac5a0534fa5dd90d3638cebd3a6fb8a116e45c52370980a2a64c06b46223f5c5afa5558a0724c205b4d0d719c5aaadbababf41212240631475d4560bb75d3341c05ebc2a5dca97817decd257d8f82bb872c73ceb3e436a13fd30cb913d95c68d27027ec7410efe3636386437ea0e4345c3d6dd1f98f72961fa443ad538e9c98e592346f37eb53788c217c98dcb98e6ee5c60d870f1921fc0855272f3ce0d8932aa63c8e3eae20969c322c3ae8429491e06a9ab272b2278c34b54c286fe5b50f4dc42715348c938bc2e8483349eda7e9064a1b39376be96ed6b65e71c03e4bed784c54f776ee1dcef3497c9e917f810c8faa38e3edbe48bb29155fc6a3dc9a5f210e860b1c3ced71f055ea57d7767533393d3565ceb1de38d3c27975cdf51105b3945ab82f521e090598e483a5af6cc79ec537d9e1b714dc211c0e8d8bf3a5e07745f7de22cc988aefe2599efbefd11579b8f7d0101d3de5b5559cc7852a74e022d1def32a687f9ee26439dd55fa89ceca792c306d8b3445c39c5248371d434fcf85c489423e5eb885fd08dfaf034cc98b14c954f1033e7977e31a77a7ed9d2e2a7e8407f838fe71c9815d74b26ec44f9988eb7cca5fe5d5cf146cf35a3194b6ad16d743131ab71d6f260b19becc0884c92f156cce774358f21fcb3fb3961b09e2d704cbb433bd3374502a88848facac71191103fc2d7ec7e7c4ef29467e885789f1478a914899f2a3a9327ca4cb4bf02f4cc15fe9444a663354bd69be69fcdd769a1eb549574f1d1bd0a786f53193f6d5497bda491907b2a6e1df4ab5f183ee3cfad9c477207dcb6afc5143b2bfd3ba022aed6b4bf6f4d151d8d7d39eaefdc2fe0e5aaf2f7abf81c051e7e14efaff0f929ca2483e7a8e4517d018d536695b1671ef253447b5b05c46a35a4c6b5bc4f64bd819bd82dda3da7d5a879658c0fd97d019d5bab58478d71b7d1ecd97f16605377027af5b2f63a802b48ac6c4ea024551f04f9191f23fe8f0055011c016fa156f9af080c4d4404f859eb50597d7b0e53c20d45acaaa454bd51ec421a93648597386ed1731dc3a8fb79e41c07f167e9f7678110f93e94e029aaa20dbb681d87554c7e691e1d7e70a706be1afdbafdcc4e600daf67348ba8aa4ef46f25c41cf3af2d3d9aa1d9b877d0d893c86a982de66a9b78ef47a5b09c865b83e14a94e6346aa1e24553f3d5ba384647630be0cf209821c5fc47b49a6bd9fe1b792d2c9256669b66f420b2041382bf8fe924eb7914be6800bd31ba3843fe4a3ba720076f0f80589e28982413319308a4689a238669c6d3e9ab7f9181e93360f91c51a7aee8ac6c9a6c34f361d950dfe864a91413d4b3f2136a7f3e97cca4b212edd7939d4c1f71f6ca31ce8d727f2a82b847858c23a28423035da67c8478c182da6e973ec9764a47432ca0c9e8ec609f397b84abc78ca0bfacc52d04a546c12b5fd1a0c196bbd6caf205bcde3ebe764c2dfc0b352e32ec2c6555559a3691edfbe868e7c41bf8373522b21661ad8b2acd706e3d75113df348fef9fc59a8b78ee7c018aca356ca45ea34fcd0eb25c5728caa8ace2fda59d7c89f3a5bc2e17245784a455e6cc8ba79810ae5c51d641d1d9f594b89fd2bd2ac36c97619aa364363b10f5a29d14bd765a34fa3c5e8ac63cf1335e1ff8f96691f61b242d5552f7871e73157cad4b953ed9e4edcc496c89931b68bc82b6510af49305dc18146fe3a25bb98a3f2f464e03192192c8ed9305b70f4ab73b4bdc5ecfd3f20b9e1ff2f42baa7ee68c18db9d31450458f25d03df4d6c14c3de44a2a70bddb74336784bbdff45f8477dda6f92a3fed6e468652c39ba269eecf0d783e45ecf2fe20ff90939b5ba833fdd868320fe4c9de63968128501d65e4162b47ec3d5e002fef61c86f391fe25680efc1f504b0708967280dced07000005110000504b03041400080808000000210000000000000000000000000007000900442e636c6173735554050001000000008d546d531b55183d3701f2c2d2d208455bb52fd23609a1b456a5361185d0b494d06a13534b555c3677e892b09bd9dda0fc137f443fe08ca56f337ef483bfc9713c7737e04256a6c94c9ebd27e7793f77fffae7f51f0066d114108b0908815269f9567553dfd667dabab531f3607d531a5eb11181cdf54302a347b104060432b7adee9674f4f5b65cd13b571587094d8178b542a764b552aa2f17e7f82836054e545dc376e4cca269788b0b044f1f0214b5def0d94325d332bd3981d96ca8989ae798d646318494dbbaebf603b986c0fc5b7806c5f5a3aa0815239ecd35348c60348d419c62139504de617562ad2577dc24c60526ff7336ad6dbb257bb9cab665e85e45373cdbd949604260624b6fc9007e647a4ff9e47abae5b902bf864bed455991de53bb7957b79a6de94e566dbbd5ed148fede890637da72323e84ffa579beb0f51d6dbed9ae9c9a286f770268d7771f6e410de17b81c31d35c3fa4dc3ecc507fe7a25d22f6a5a67c218d315cd4904032851826a91fb1b6adb7bb92a3be9c8150f14602c5707a9efc8522cc09a42cf973a020811b6f95eeb00e354ca190461ed31ad21856b967b86bdddfff9286ebf858557683585b603c1b31c3558a224b31e556357c8acf14fd26e95b8abe948bba4f43c4e940d2ba862f50542ed4bbb08e8c2c624b0731927e4aaa55400b77944099b56f484fc36dcc0f63111546b6056e46443e7ea307b9cea85c115c66d7f015e6d39cda32db72e4b674bc2363da2773cd2bb8af46fd80057504ae1c5fd07ef3bc8aa96cf076f0afa5ab5aabe3a16aed5b4632fe672dccf708dfa9d13e26abb9bf24c24f02f80706ae991b96ee751d293050b69b3423354f375a7ca1d5d58b4d205db3bb8e212ba63a8c2ed8b6e77a8ede096e9a8b0b6c7d906a8f21a3b44b9daef9a714cfd4d3c159f3ff1bc1093eff44e43abd06682fe55f20937f83b1c753af711e28bcc047cf89f29405a65fe2ea735cfb0dea13043ac93014257f5598315a419bccff8e4b7bf8e499cf144a87bd44e3b431da94624cede1f367a160b3a4de42318a7a760f5fee86a82552b9ea1e75a2471d26f5dad42bdc89214c5e20f92e967ae402adea359367feeafde93f3138bd5b7889afc5ae5facae1a80f81b5a82530922dc23fe0d1ef6229c479c5fb6eba72bbc42238e5e3fabe1e1d4e8c5ed86bc62075e22ecf563d8eb7bf282a738d67d3b048356edea03463cedff5ef917504b0708b554f9817103000058070000504b03041400080808000000210000000000000000000000000007000900462e636c61737355540500010000000095545d73d346143d6b192b71149218489af2510a21f88b041a3e4a9cba1087909484d03a756829a51b6931c246f248eb40f8259dbef491171e60a6d098874e9f78e86f6298de9515e3c486017b46bb7b75eeb9e7ea1ee9bfb7affe0170017719d8bc0ec6909c294d2fdde71b7cb2ca9df2e4cafa7d61ca5cbe33c430b83ba623ca90b8e2d41f088faf574551c8098521f20ac3c0926fba9e98bcec797c736e9608f6ef8cccac9672790ab32ac3def0d69c6dca003bbe23a0a06d92161d29cac20bb26333b663cb3c6524db1045e9d94eb93da750e5be9f4b9518321f016c6a53682d992a19e8c7601c7b30c4d0cbee08879284df837d0c63ef126d67c3ad8890b1e03a2697f3dc94aeb7a9e300c3c8035e11cdf09a2defd1ce97dc913ec3efed8242966521efb9d60277acaaf0c7965cb752afe53ea87b47e2ea664d7481dfea9c6baa93a2c0abd5a22d45cec0083e8b6318a303317cdefd11a73a432aed50828c7698a1bf3946ea568a47e4982f18e28e78185a80e1ec474d6d97950c7c8963711cc571033a7a7a11c1896032b66389476a32271360aafc50876974a4094a129ace6298fa1405a13f0d64714a09983010479f12709a8ccc03bb2cb6ba0ef5ea38cb10f5edc7c2c0794cf5e11c2e107a9de1407231d5ed558b519c1c487465210dcc605a257da312ba4cf067954070b531da75eab8bc6b685d861e865495421f663147d2ccf7542a6d572aa9bebf8d53dfd4adc62dcbc0355c55229718f40d5ead8b15fac80cefec6ffbbd35701d2b71647083927d21194e76a9d6adbe811f50542a5749a545d935b7461f9664d786d6705329fa89a1c77664498932700b53aaf22f81b8f795f855e5dd219f14edb2c365dd1334c0826bd1d25f94dcac2cf3daaafae4919b8b6edd33c5bcad0e83b3ae2b7de9f15af335f4c9a811fa6e80ae09655572250f4ebd7426e7b4ce0662b4efc75edaaf5364021afd8163e9bf9148675ee10890ddc2d80b8cab530a4864b630f902679e43fd9a2c03c4f115a6e8aa38866965b4c6d37f61bc81af199e0658868b980eeb8cd01aa1b54f610e36908fe0591b618ec034e8109c0ec1fb087c26d3c095085e438f3e41547b1af09a74dd83c8d0a5edb62e51701e57c3fc3cb5a4f253e9cc4b7cf7078eaba2c4b31c41c0d8d2b985ef1bf851c3f316ab06960c391728546a717a744b3de09bef34fd8bcc72f635165a74f9e68e5e8fe968006301fbe1ec4bdcfe1347d55db58d5aa3d1067ed30231a3d1ec2e0934bc3758d3c93cdb3ab470a7c10ad61804ad6a840729677f704dfe0f504b07085050f958a403000075070000504b0102140014000808080000002100eb643fc02a0000002800000014000d0000000000000000000000000000004d4554412d494e462f4d414e49464553542e4d46555405000100000000feca0000504b0102140014000808080000002100caf61b0743010000010400000d00090000000000000000000000790000004d4554412d494e462f41504953555405000100000000504b01021400140008080800000021007beed8bf870100006f020000070009000000000000000000000000020000452e636c617373555405000100000000504b010214001400080808000000210025417ef550000000560000000700090000000000000000000000c5030000412e636c617373555405000100000000504b01021400140008080800000021006ebdec4910020000d6030000070009000000000000000000000053040000422e636c617373555405000100000000504b0102140014000808080000002100967280dced070000051100000700090000000000000000000000a1060000432e636c617373555405000100000000504b0102140014000808080000002100b554f98171030000580700000700090000000000000000000000cc0e0000442e636c617373555405000100000000504b01021400140008080800000021005050f958a40300007507000007000900000000000000000000007b120000462e636c617373555405000100000000504b05060000000008000800070200005d1600000000')
            .params({
                _name: `${values.name}`,
                _symbol: `${values.symbol}`,
            })
            .build()

        const customEvent = new CustomEvent('ICONEX_RELAY_REQUEST', {
            detail: {
                type: 'REQUEST_JSON-RPC',
                payload: {
                    jsonrpc: '2.0',
                    method: 'icx_sendTransaction',
                    params: iconService.IconConverter.toRawTransaction(deployTransaction),
                    id: Math.floor(Math.random() * 10000) + 1
                }

            }
        });
        window.dispatchEvent(customEvent);
    };

    return (
        <div style={{textAlign: 'center'}}>
            <h3>Deploying IRC3 (Non-Fungible Token)</h3>
            <h4>Address: {address}</h4>

            <Form
                name="irc3Form"
                onFinish={onFinish}
                labelCol={{span: 8}}
                wrapperCol={{span: 16}}

                style={{maxWidth: 600, margin: '0 auto'}}
            >
                <Form.Item
                    label="IRC3 Name"
                    name="name"
                    rules={[{required: true, message: 'Please input your IRC3 name!'}]}
                >
                    <Input placeholder="MyIRC3Token"/>
                </Form.Item>

                <Form.Item
                    label="IRC3 Symbol"
                    name="symbol"
                    rules={[{required: true, message: 'Please input your IRC3 symbol!'}]}
                >
                    <Input placeholder="NFT"/>
                </Form.Item>
                <Form.Item wrapperCol={{offset: 8, span: 16}}>
                    <Button type="primary" htmlType="submit">
                        Deploy IRC3
                    </Button>
                </Form.Item>
            </Form>
            {transaction_result && (
                <div>
                    <h3>Transaction Result:</h3>
                    {transaction_result.error ?
                        (transaction_result.error) :
                        (<a target='_blank' rel='noopener noreferrer' href={`https://tracker.${networkId === 2 ? 'lisbon.' : ''}icon.community/transaction/${transaction_result.result}`}>{transaction_result.result}</a>)}
                </div>
            )}
        </div>

    );
};

export default IRC3Form;